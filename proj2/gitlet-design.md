# Gitlet Design Document

**Name**:

## Classes and Data Structures

### Stage

Represents a staging area.

#### Fields

1. `HashMap<String, String> added`: <filename, blob's uid>.
2. `HashSet<String> removed` : <filename>.

### Blob

Represent a file.

#### Fields

1. `String filename`: absolute path.
2. `byte[] content`: `Utils.readContents(new File(filename))`.
3. `String uid`: `Utils.sha1(filename, content)`.

#### sha1
filename + content && filename + contentString(`Utils.readContentsAsString(file)`) have the same sha1.
When finding a Sting parameter, `Utils.sha1` will convert it to a byte[]. 
As a result, content & contentString share the same sha1.
Also, they can be converted as below:  
```
content = contentString.getBytes(StandardCharsets.UTF_8);
contentString = new String(content, StandardCharsets.UTF_8);
```

### Commit
Represent a commit.

#### Fields

1. `String message`: commit msg from user input, commit <msg>.
2. `Date timestamp`: time when commit are created, generated by Constructor.
3. `String parentId`: parent commit.
4. `Map<String, String> Blobs`: <filename, blob's uid>, tracking files.
5. `String uid`: `Utils.sha1(message, timestamp.toString(), parentId, blobs`.

## Algorithms

### commit

+ Create a new commit, with user input message, timestamp when it's created, parentUId, tacking files.
+ blobs should inherit from its parents, also with files in staging area, update the added and del the removed.
+ move all blob files in staging directory to blobs directory. Re-instantiate the stage object. aka, clear the stage. and write it back to the stage file.
+ change the tips of the branch, the content of master file. HEAD does not need to move since the file just store the path of the tips of branch.
+ `Each commit is identified by its SHA-1 id, which must include the file (blob) references of its files, parent reference, log message, and commit time.`

## Persistence

```
.gitlet
	-- staging
	-- refs
		-- heads -> [master][branch name]
	-- blobs
	-- objects
	--[HEAD][stage]
```



`HEAD` file: stores the reference path of current commit file.
`refs` directory: stores different branch, filename is branch name,
    file content is the tips of branch, represented with uid of commit.
`Objects` directory: stores Blobs and Commits, filename is their uid, content is Utils.writeObject(Obj).
if changing file needed(check out ETC), use `Blob.content` filed.